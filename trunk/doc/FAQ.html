<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<HTML>
<head>
	<title>APC Toolkit Action Aplications - Developers FAQ</title>
  <link rel=stylesheet type="text/css" href="devnotes.css">
</head>
<body>
<a href="index.html">Other documentation</a><br>
<hr><br>
<a href="#newaa">How to create new Action Aplication</a><br><br>
<a href="#anonymous">How to create form for anonymous posting from public website?</a><br><br>
<a href="#aalanguage">How to create aa in alternate language?</a><br><br>
<a href="#aaslices">What are the 'Action Aplication Core' and 'News (EN) Template' slices?</a><br><br>
<a href="#feeding">How works the internal feeding?</a><br><br>

<a name="newaa"></a>
<h3>How to create new Action Aplication</h3>
<p>   The applications in v1.5+ should be created quite easy.<br>
<ol>
  <li>Chose one slice and create the set of fields you want to have in new application.<br>
    <br>
  </li>
  <li>Change for this fields the default values, help texts, names, priorities, 
    aliases, etc. in admin interface (<font color="#663333">"Admin" -> "Main settings 
    - Fields"</font>).<br>
    <br>
  </li>
  <li>Change the design of fulltext view, list item view and possibly the admin 
    view (<font color="#663333">"Admin" -> "Design - Fulltext"</font>, <font color="#663333">"Admin" 
    -> "Design - Index"</font>, <font color="#663333">"Admin" -> "Design - Item 
    Manager"</font>)<br>
    <br>
  </li>
  <li>Test this new slice, if it is working well<br>
    <br>
  </li>
  <li>Add new slice based on this one (not template, but slice)<br>
    <br>
  </li>
  <li>Mark the new slice as Template (<font color="#663333">"Admin" -> "Main settings 
    - Slice"</font>) - for that you must be superadministrator (four stars).<br>
  </li>
  <br>
</ol>


<a name="anonymous"></a>
<h3>How to create form for anonymous posting from public website?</h3>
<ol>
  <li><b>Enable anonymous posting</b><br>
    <br>
    First thing you have to do is to permit anonymous posting from web. This can 
    be done on <font color="#663333">"Admin" -> "Main settings - Slice"</font> 
    page where is the option <font color="#663333">"Allow anonymous posting of 
    items"</font>. There you should select to what bin the anonymous posted items 
    should go ("<i>Active</i>" and "<i>Holding bin</i>" are the possibilities).<br>
    <br>
  </li>
  <li><b>Create form</b><br>
    <br>
    The easiest way how to create input form is to display standard input form 
    from admin interface (<font color="#663333">"Add item"</font>). Then you should 
    view source code for displayed page and copy the code, which is between &lt;form 
    ...&gt; and &lt;/form&gt; tags inside HTML code for new public page (newitem.html 
    for example). <br>
    <br>
    In the form you can make as many chages you want, but one change is realy 
    needed. There should be changed the url of script, where the form is posted 
    to <b>filler.php3</b>:<br>
    <br>
    Change it from<br>
    <br>
    <code>&lt;form enctype='multipart/form-data' method=post action='/apc-aa/admin/itemedit.php3?AA_CP_Session=2bbb85e9205239910a222b4c59cee2fa'></code><br>
    <br>
    to<br>
    <br>
    <code>&lt;form enctype="multipart/form-data" method=post action='/apc-aa/filler.php3'></code><br>
    <br>
    That is all what you need. In next paragraph are just tips and tricks for 
    better customization.<br>
    <br>
    <b>Tips &amp; Tricks</b><br>
    <ul>
      <li>You can delete all the fields from form, but <b>slice_id</b>. The slice_id 
        should allways remain.<br>
        <br>
      </li>
      <li>The inputs are <b>validated</b> as if it was typed in standard itemedit.php3 
        form. If there are some invalid data, whole item is admitted. It is very 
        good idea to add your own javascript validatoin of form before it is send 
        to filler.php3 script.<br>
        <br>
      </li>
      <li>You can disable the standard AA validation by adding hidden field <b>notvalidate</b> 
        in the form:<br>
        <code>&lt;input type=hidden name='notvalidate' value='1'&gt;</code> <br>
        <br>
      </li>
      <li>The page, which appears if the item is correctly stored to database 
        can be specified in <b>ok_url</b> variable:<br>
        <br>
        <code>&lt;input type=hidden name='ok_url' value='http://www.apc.org/thanks.html'&gt;</code> 
        <br>
        <br>
      </li>
      <li>The page, which appears if the item is not correctly stored to database 
        (due to validation problems, ...), can be specified in <b>err_url</b> 
        variable:<br>
        <br>
        <code>&lt;input type=hidden name='err_url' value='http://www.apc.org/invalid.html'&gt;<br>
        <br>
        </code></li>
      <li>It is possible to set values for not displayed fields just by adding 
        hidden field for such field:<br>
        <br>
        <code>&lt;input type=hidden name='v696d675f6865696768742e2e2e2e2e2e' value='Anonymous 
        author'&gt;</code><br>
        <br>
        Note:<br>
        This solution is easy and good for many cases, but it is by no means secure. 
        Any experienced user can change values of hidden fields so don't relly 
        on such data. Better solution is to completely omit such fields from input 
        form and set the default values for the fields in <font color="#663333">"Admin" 
        -> "Main setting - Fields" -> "Edit" -> "Default"</font>. The values then 
        are set dirrectly from database. This solution is a little bit more secure. 
        <br>
        <br>
      </li>
      <li>It is possible to send <b>images</b> and other <b>files</b> by the form 
        (unlike the anonymous posting in version prior 1.5)</li>
    </ul>
  </li>
</ol>

<a name="aalanguage"></a>
<h3>How to create aa in alternate language?</h3>
<p> If you want to translate ActionApps to other national language, you can look 
  at:</p>
<ul>
  <li> <b>include/en_common_lang.php3</b><br>
    <br>
    - this is the file with language constants definions which is common to all 
    slices in the AA instalation (you can look at cz_common_lang.php3, which is 
    the same file for czech language) <br>
    <br>
  </li>
  <li> <b>include/en_news_lang.php3</b><br>
    <br>
    - this is the file with language constants definions for specific slice. It 
    is possible to have slices in different languages. You can choose the used 
    language on "Admin" -> "Main settings - Slice" page. So if you want to have 
    slice in french, you have to copy en_news_lang.php3 to new file (fr_news_lang.php3 
    for example) and translate the texts to french to fit your needs.<br>
    <br>
  </li>
  <li> texts in template slice <b>News (EN) template</b> (see <a href="#aaslices">Templates</a> 
    section)<br>
    <br>
  </li>
  <li> texts in fields templateslice <b>Action Aplication Core</b> (see <a href="#aaslices">Templates</a> 
    section)</li>
</ul>
<a name="aaslices"></a>
<h3>What are the 'Action Aplication Core' and 'News (EN) Template' slices?</h3>
<i>There are two (and should be more in the future) odd slices in slice listbox. Why?</i>
<p>Both, the '<i>Action Aplication Core</i>' and '<i>News (EN) Template</i>' are 
  visible only to superadmins and both should not have any items.</p>

<p><b>News (EN) Template</b><br>
  <br>
  '<i>News (EN) Template</i>' slice is just template for creating new slices. 
  This template is shown is option in <font color="#663333">"Admin" -> "Add Slice"</font> 
  dialog in templates listbox. If you feel, that the setting for new created slices 
  is not optimal you have two possibilities:<br>

<ul>
  <li>Modify the setting for '<i>News (EN) Template'</i> slice on <font color="#663333">"Admin"</font> 
    pages. The new slices based on modified template will be set-up just like 
    current setting in template slice.<br>
    <br>
  </li>
  <li>Create new application (= template) as described in <a href="#newaa">New 
    Aplication section</a></li>
</ul>
<p></p>
<p><b>Action Aplication Core</b><br>
  <br>
  '<i>Action Aplication Core</i>' slice is another case. In this slice are defined 
  default values for each <b>field type</b>. This values will be used if you will 
  add new field to slice on <font color="#663333">"Admin" -> "Main settins - Field"</font> 
  page. There you should fill field name, priority and field type. After you click 
  update, new field is added o database for the slice and the values (like validate 
  function, alias, help text, ...) is copied from the same field in '<i>Action 
  Aplication Core</i>' slice. It is good idea to translate the help texts in the 
  '<i>Action Aplication Core</i>' slice too, if you are translating whole ActionApps 
  to some other national language. </p>

<a name="feeding"></a>
<h3>How works the internal feeding?</h3>
<p>If you write an item which goes into <i>Active bin</i> or if you approve an 
  item, then the feeding function is invoked. This function finds all slices, 
  where the item should be fed (depending on current feeding permissions (<font color="#663333">"Admin" 
  -> "Content sharing - Import &amp; Export"</font>) and feeding setings (<font color="#663333">"Admin" 
  -> "Content sharing - Filters"</font>)). The feeding goes deep and deep until 
  cycle is detected or feeding into <i>Holding bin</i> is set. </p>
<p>Feeding one item from one slice to another means:<br>
<ul>
  <li>Content of each filed is copied to to new slice (there are one excepion 
    - see <i>STATE_UNFEEDABLE</i> flag in following text)<br>
    <br>
  </li>
  <li>The content is copied including the <i>HTML codded / plain text</i> flag<br>
    <br>
  </li>
  <li>Field is fed to field with the same field_id as default (<i>headline........</i> 
    will go to <i>headline........</i> field). This can be changed in <i>feedmap</i> 
    table, where you can map one field to another (this feature is currently implemented, 
    but there are still not the admin inteface for seting the mapping - the feedmap 
    table is currently empty and you can't change it from admin interface)<br>
    <br>
  </li>
  <li>flag <i>FLAG_FEED</i> are set for each stored value (see <i>FLAG_*</i> definitons 
    in following text)</li>
</ul>
<p></p>

<p>Let's look in constants.php3 file:<br>
  <br>
  <code> # content table flags<br>
  define( "FLAG_HTML", 1 );<br>
  define( "FLAG_FEED", 2 );<br>
  define( "FLAG_FREEZE", 4 );<br>
  define( "FLAG_OFFLINE", 8 );<br>
  <br>
  # states of feed field of field table<br>
  define( "STATE_FEEDABLE", 0 );<br>
  define( "STATE_UNFEEDABLE", 1 );<br>
  define( "STATE_FEEDNOCHANGE", 2 );<br>
  <br>
  # relation table flags<br>
  define( "REL_FLAG_FEED", 2 ); # 2 - just to be compatible with content table<br>
  </code><br>
  <br>
  There we see, the various flags can be set. The most important are the flags 
  for <i>field</i> table. For each field you can set if this field is<br>
<ul>
  <li>feedable (<i>STATE_FEEDABLE</i>) - the content for this field is copied 
    to new slice and user in new slice can freely edit it<br>
    <br>
  </li>
  <li>unfeedable (<i>STATE_UNFEEDABLE</i>) - the content for this field is never 
    copied to the new slice<br>
    <br>
  </li>
  <li>feedable, but locked (<i>STATE_FEEDNOCHANGE</i>) - field is copied to new 
    slice, but the flag <i>FLAG_FREEZE</i> is set for the field, so user in new 
    slice can display the content of this field, but she can't change the value</li>
</ul>
These setting can be done on <font color="#663333">"Admin" -> "Main settings - 
Fields" -> "Edit" -> "Feeding"</font> page.<br>
<br>
Depending on <i>field</i> table flags, the flags for <i>content</i> table are set:<br>
<ul>
  <li><i>FLAG_HTML</i> is allways copied from source field</li>
  <br>
  <br>
  <li><i>FLAG_FEED</i> is ollways set for fed fields (currently it have no specific 
    use - we just marking the fed content<br>
    <br>
  </li>
  <li><i>FLAG_FREEZE</i> is set if source field has <i>STATE_FEEDNOCHANGE</i> 
    flag set. In other cases is this flag unset. All fields with <i>FLAG_FREEZE</i> 
    are never displayed in input form so it can't be changed by user in destination 
    slice.</li>
</ul>
<p></p>
<p>After copying the contents, the relation table is updated. This table holds 
  information about feeding tree (from which item is content fed to another). 
  The ralation table will be used for another purposes in future too (for holding 
  discussion threads, ...), so each record for feeding if flaged as <i>REL_FLAG_FEED</i>.<br>
  <br>
  <b>Note</b>: The information from relation table could be used for <i>content 
  sharing</i> in the future. The <i>content sharing</i> means, that if the content 
  is changed in source slice, it is changed in destination slice too. For that 
  purpose could be new <i>STATE_FEED&amp;UPDATE</i> flag itroduced. After updating 
  the content of such field, the <i>relation</i> table is checked for depending 
  items (= fed items from this item) and the appropriate fields are updated too. 
  (or is there other solution?)</p>
<br><br>
<a href="index.html">Other documentation</a><br>

</body>
</html>
