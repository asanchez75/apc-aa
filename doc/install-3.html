<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.7">
 <TITLE>AA Installation: Installation steps</TITLE>
 <LINK HREF="install-4.html" REL=next>
 <LINK HREF="install-2.html" REL=previous>
 <LINK HREF="install.html#toc3" REL=contents>
</HEAD>
<BODY>
<A HREF="install-4.html">Next</A>
<A HREF="install-2.html">Previous</A>
<A HREF="install.html#toc3">Contents</A>
<HR>
<H2><A NAME="s3">3. Installation steps</A></H2>

<P>
<P>
<H2><A NAME="ss3.1">3.1 MySQL installation (RPM)</A>
</H2>

<P>Skip this step if you have MySQL already running. 
<P>
<BLOCKQUOTE><CODE>
<PRE>
# rpm -ivh MySQL-client-3.22.32-1.i386.rpm
# rpm -ivh MySQL-3.22.32-1.i386.rpm
</PRE>
</CODE></BLOCKQUOTE>
<P>Set the initial MySQL root password:
<P>
<BLOCKQUOTE><CODE>
<PRE>
# /usr/bin/mysqladmin -u root password 'password1'
</PRE>
</CODE></BLOCKQUOTE>
<P>Install development files:
<P>
<BLOCKQUOTE><CODE>
<PRE>
# rpm -ivh MySQL-devel-3.22.32-1.i386.rpm
</PRE>
</CODE></BLOCKQUOTE>
<P>
<H2><A NAME="ss3.2">3.2 OpenLDAP installation (RPM)</A>
</H2>

<P>If you plan to use the LDAP permissions module, you need the LDAP
server. Here is a quick installation guide for OpenLDAP. Detail
inctructions can be found at the 
<A HREF="http://www.openldap.org">OpenLDAP HomePage</A>. If you are already running a LDAP server,
read this and next step and load listed entries into your server.
<P>
<H3>RPM install</H3>

<P>
<BLOCKQUOTE><CODE>
<PRE>
# rpm -ivh openldap-1.2.9-1.rpm 
# rpm -ivh openldap-servers-1.2.9-1.rpm
# rpm -ivh openldap-devel-1.2.9-1.rpm 
</PRE>
</CODE></BLOCKQUOTE>
<P>
<H3>Customize configuration files</H3>

<P>Edit the <B>/etc/slapd.conf</B> file - you can use the AA's
doc/slapd.conf as a template. This file should not be world readable.
<P>Decide your basedn (dc=ecn,dc=apc,dc=org is an example in the AA
package), rootpw, directory where the LDAP databases will be stored.
<P>Edit <B>ldap.conf</B> - BASE and HOST. This file is used by local LDAP
clients (ldapmodify etc.).
<P>
<H3>Create the directory for the first LDAP database.</H3>

<P>
<BLOCKQUOTE><CODE>
<PRE>
# mkdir /var/ldap/ecn.apc.org
</PRE>
</CODE></BLOCKQUOTE>
<P>
<H3>Setup logging</H3>

<P>I recommend to define a separate file for logging in syslog.conf:
<P>
<PRE>
local4.*                                     /var/log/ldaplog
</PRE>
<P>
<H3>Start the OpenLDAP server:</H3>

<P>
<BLOCKQUOTE><CODE>
<PRE>
# /etc/rc.d/init.d/ldap start
</PRE>
</CODE></BLOCKQUOTE>
<P>
<H3>Create initial LDAP database</H3>

<P>To create the initial database, you can use the doc/LDIF.init
example. It includes the root object, a AA Admins group, a personal
account (karel) and an account for the AA scrips. Customize this file!
(basedn, uid of your personal account). Then use ldapmodify, rootdn and rootpw defined in slapd.conf to add new entries into LDAP:
<P>
<BLOCKQUOTE><CODE>
<PRE>
# ldapmodify -a -f doc/LDIF.init -D "cn=root,dc=ecn,dc=apc,dc=org" -W
</PRE>
</CODE></BLOCKQUOTE>
<P>Test if you can search new entries:
<P>
<BLOCKQUOTE><CODE>
<PRE>
# ldapsearch -L objectclass=\*
</PRE>
</CODE></BLOCKQUOTE>
<P>Set password of your LDAP account:
<P>
<BLOCKQUOTE><CODE>
<PRE>
# ldappasswd -D "cn=root,dc=ecn,dc=apc,dc=org" \
-W -t "uid=karel,dc=ecn,dc=apc,dc=org" -H ssha
</PRE>
</CODE></BLOCKQUOTE>
<P>In this example, LDIF.init has set the uid karel to be the superuser
in the Action Applications.  The superuser can add slices and users.
So remember this password for the action application login page.
<P><I>ldappasswd can be used to convert the plaintext password in
slapd.conf to an encrypted form (change passwd of arbitrary account in
LDAP, search it using ldapsearch as root and then paste it into
slapd.conf).</I>
<P>Try to bind to LDAP using your account:
<P>
<BLOCKQUOTE><CODE>
<PRE>
# ldapsearch -D "uid=karel,dc=ecn,dc=apc,dc=org" -W objectclass=\*
</PRE>
</CODE></BLOCKQUOTE>
<P>
<H2><A NAME="ss3.3">3.3 OpenLDAP - AA specific configuration</A>
</H2>

<P>You need to include AA specific objectclasses into the schema used by
your LDAP server, create ACL object for the AA aplication and an
account used by the AA scripts to access LDAP.
<P>Copy schema extensions from the AA doc directory:
<P>
<BLOCKQUOTE><CODE>
<PRE>
# cp doc/slapd.oc.* /etc/ldap
# cp doc/slapd.at.* /etc/ldap
</PRE>
</CODE></BLOCKQUOTE>
<P>Modify slapd.conf to include these files (done in the
doc/slapd.conf example).
<P>Restart slapd to reread its config.
<P>
<P>Create the aalduser account and set its password (password4 in the
LDIF.init example). This account should have permissions in slapd.conf
to modify the LDAP database. You need only set the password if you used the LDIF.init and example slapd.conf.
<P>
<BLOCKQUOTE><CODE>
<PRE>
# ldappasswd -D "cn=root,dc=ecn,dc=apc,dc=org" \
-W -t "cn=aalduser,dc=ecn,dc=apc,dc=org" -H ssha
</PRE>
</CODE></BLOCKQUOTE>
<P>Create the APCACL object (you are done if you used the LDIF.init
example, otherwise customize it and use ldapadd or ldapmodify -a to
add it into your LDAP).
<P>
<P>
<H2><A NAME="ss3.4">3.4 Apache with PHP support</A>
</H2>

<P>Here is a overview how to build Apache with PHP:
<P>
<BLOCKQUOTE><CODE>
<PRE>
% cd /usr/local/src
% tar xvzf apache_1.3.9.tar.gz
% tar xvzf php-3.0.14.tar.gz
% cd apache_1.3.9/
% ./configure --prefix=/usr/local/httpd/
% cd ../php-3.0.14/
% ./configure --with-mysql=yes --with-apache=../apache_1.3.9 \
   --enable-track-vars --enable-safe-mode --with-xml --with-ldap 
% make 
% make install
% cd ../apache_1.3.9/
% ./configure --prefix=/usr/local/httpd \
--enable-module=so \  (if you wand to use DSO)
--activate-module=src/modules/php3/libphp3.a
% make
% su
# make install (or "make install-programs" if you want just to upgrade Apache binaries)
# cd ../php-3.0.14/
# cp php3.ini-dist /usr/local/lib/php3.ini
</PRE>
</CODE></BLOCKQUOTE>
<P>Uncomment following lines in <B>/usr/local/httpd/conf/httpd.conf</B>:
<P>
<BLOCKQUOTE><CODE>
<PRE>
AddType application/x-httpd-php3 .php3

AddType text/html .shtml

AddHandler server-parsed .shtml
</PRE>
</CODE></BLOCKQUOTE>
<P>Optionally add index.php3 to index files:
<P>
<BLOCKQUOTE><CODE>
<PRE>
DirectoryIndex index.html index.php3 
</PRE>
</CODE></BLOCKQUOTE>
<P>Restart Apache and test the PHP functionality: in the htdocs directory
create simple script test.php3:
<P>
<BLOCKQUOTE><CODE>
<PRE>
--- cut ---
&lt;?php phpinfo() ?>
--- cut ---
</PRE>
</CODE></BLOCKQUOTE>
<P>and try to access with your browser ( http://localhost/test.php3).
<P>
<H2><A NAME="ss3.5">3.5 Install PHPLIB</A>
</H2>

<P>Extract the phplib-7.2.tar.gz, create a directory
/usr/local/httpd/phplib and copy all files from phplib-7.2/php/* to
this directory.
<P>In <B>/usr/local/lib/php3.ini</B>, include this directory in the
include_path variable.
<P>
<BLOCKQUOTE><CODE>
<PRE>
include_path = /usr/local/httpd/phplib
</PRE>
</CODE></BLOCKQUOTE>
<P>You can also include this path in httpd.conf:
<P>
<BLOCKQUOTE><CODE>
<PRE>
&lt;Directory /usr/local/httpd/aa&gt;
     php3_include_path "/usr/local/httpd/phplib"
&lt;/Directory&gt;
</PRE>
</CODE></BLOCKQUOTE>
<P>Restart Apache. You do not need to edit PHPLIB files, all
class extensions are in AA scripts.
<P>
<P>
<H2><A NAME="ss3.6">3.6 Create AA database in MySQL</A>
</H2>

<P>Use the template <B>aadb.sql</B> in AA doc directory:
<P>
<BLOCKQUOTE><CODE>
<PRE>
# mysql -u root -p
mysql> CREATE DATABASE aadb;
mysql> QUIT
#mysql -u root -p aadb &lt; doc/aadb.sql
</PRE>
</CODE></BLOCKQUOTE>
<P>Create a user in MySQL that will be able to access the new aadb database:
<P>
<BLOCKQUOTE><CODE>
<PRE>
# mysql -u root -p
mysql> USE mysql;
mysql> GRANT SELECT,INSERT,UPDATE,DELETE 
ON aadb.* 
TO aadbuser@localhost 
IDENTIFIED BY 'password2';
mysql> FLUSH PRIVILEGES;
mysql> quit
</PRE>
</CODE></BLOCKQUOTE>
<P>
<H2><A NAME="ss3.7">3.7 Customize AA configuration file</A>
</H2>

<P>Customize defines and global variables in <B>aa/include/config.php3</B>.
This file should not be world readable!
<P>
<UL>
<LI>Absolute path to the AA include directory</LI>
<LI>Hostname of your MySQL server, the name of the database and
username/password pair</LI>
<LI>Change the id for your node (32 characters, only alfanumerical)</LI>
<LI>Select the permission library of your choice</LI>
<LI>Configure options specific for the selected permissions library</LI>
<LI>Select language</LI>
</UL>
<P>
<HR>
<A HREF="install-4.html">Next</A>
<A HREF="install-2.html">Previous</A>
<A HREF="install.html#toc3">Contents</A>
</BODY>
</HTML>
